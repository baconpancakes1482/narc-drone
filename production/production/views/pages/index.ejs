
<html>
<html lang="en">
<head>
<meta name="description" content="The Black Team's NARC Drone Telemetry and Video feed display interface" charset="UTF-8">
<title>NARC DRONE</title>
<link href="/css/style.css" rel="stylesheet">
</head>
<body>
    <div class="container-app">
        <div class="video-feed">
            <!-- Decide on resolution for camera feed and expect h264-->
            <div id="camera-feed"> 
		<canvas id="video-canvas"></canvas>
		 <div id="timer">
                        <div id="time-prompt">Operation Time:</div>
                        <div id="hours"></div>
                        <div id="minutes"></div>
                        <div id="seconds"></div>
                </div>
                <div id="elasped_seconds"></div>
	    </div>
        </div>
        <div class="safe-abort">
            ABORT<!-- Add a button and also initiate a post request via click with jQuery  try to avoid jQuqery-->
        </div>
        <div class="battery-status">
            <!-- Make some visual graphic for battery level with percentage-->
            <div id="battery-percentage"></div>
            <div id="battery-meter"></div>
        </div>
	<div class="t-container">
            <div class="distance-traveled">
                 <!-- Record distance traveled-->
                 <div id="distance"></div>
            </div>
            <div class="gps">
                <div id="lat"></div> 
                <div id="long"></div>  
            </div>
            <div class="position">
	        <div id="x"></div>
                <div id="y"></div>
                <div id="z"></div>
            </div>
            <div class="height">
                <div id="altitude"></div>
            </div>
            <div class="orientation">
                <div id="heading"></div>
                <div id="pitch"></div>
            </div>
            <div class="drone-speed">
                <div id="speed"></div>
           </div>
	</div>
	<div class="vehicle-health"> 
               <div class="vehicle-signals-intel">
                        <div id="uplink"></div>
                        <div id="downlink"></div>
                        <div id="signal-strength"></div>
                        <div id="packet-loss"></div>
                        <div id="latency"></div>
                </div>
                <div class="vehicle-status">
                        <div id="vehicle-initialization">
				<div id="message">'<%-messages %>'</div>
			</div>
                        <div id="flight-mode"></div>
                        <div id="lever-deploy"></div>
                </div>
                <div class="vehicle-thrust">
                        <div id="motor-1"></div>
                        <div id="motor-2"></div>
                        <div id="motor-3"></div>
                </div>
	</div>
    </div>
      
      <script>
          // operation start time in seconds
          // May have to reduce operations of time and also is this appropriate to be here?
           let operation_time = Math.round(Date.now()/1000);
           let current_year = Math.round(+new Date().getFullYear());
           let current_day = Math.round(+new Date().getUTCDate());
           let current_month = Math.round(+new Date().getMonth()) + 1;
           let minutes = 0;
           let hours = 0;
           let seconds = 0;
           let time_elasped = 0;
           console.log("Operation Start Timestamp:[ 0:0:0 %s/%s/%s ]", current_month, current_day, current_year);
    
        updateContent = setInterval(async function(){ 
              current_year = await Math.round(+new Date().getFullYear());
              current_day = await Math.round(+new Date().getUTCDate());
              current_month = await Math.round(+new Date().getMonth()) + 1;
              time_elasped = await Math.round((Date.now()/1000)- operation_time);
                  
                  seconds = await time_elasped;
                  seconds %= await 60;
                  minutes = await Math.floor(time_elasped / 60);
                  minutes %= await 60;
                  hours = await Math.floor((time_elasped/60/60));
                  hours %= await 24;

              await fetch("http://10.0.2.100:8001/api/events/?", 
                { headers: {
                    'Cache-Control': 'no-cache',
		    'Access-Control-Allow-Origin': '*'
                }
                    }).then(response => {
                  const json = response.json();
                  console.log("Timestamp:[ %s:%s:%s %s/%s/%s ]", hours,minutes,seconds, current_month, current_day, current_year);
                  console.log(json);
                  return json;
               }).then( data => {
                      console.log(data);
                      document.getElementById("message").innerHTML = data.data_packet;
                      document.getElementById("elasped_seconds").innerHTML = "Time Elasped: " + time_elasped + "s";
                      document.getElementById("hours").innerHTML = hours + "hr";
                      document.getElementById("seconds").innerHTML = seconds + "s";
                      document.getElementById("minutes").innerHTML = minutes + "min";
      
                  }).catch(error => {
                      console.log(error);
                  });
        
             }, 500);

      </script>
      <script src="jsmpeg.min.js"></script>	
      <script>
            var canvas = document.getElementById('video-canvas');
                var url = 'ws://10.0.2.100:8082/';
                var player = new JSMpeg.Player(url, {canvas: canvas});
		player.play();
      </script>
</body>
</html>
